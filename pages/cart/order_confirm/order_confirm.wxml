<form bindsubmit="submitForm">
<view class="order-confirm-container">
  <!-- 订单商品列表 -->
  <view class="goods-list-section">
    <view class="section-title">订单商品</view>
    <view class="goods-item" wx:for="{{order.cartList}}" wx:key="index">
      <image class="goods-img" src="{{item.imageUrl}}" mode="aspectFill"></image>
      <view class="goods-info">
        <view class="goods-name">{{item.goods_name}}</view>
        <view class="goods-spec" wx:if="{{item.goods_attr}}">{{item.goods_attr}}</view>
        <view class="goods-price">
          <text>¥</text>
          <text>{{item.member_goods_price[0]}}</text>
          <text>.{{item.member_goods_price[1]}}</text>
        </view>
        <view class="goods-num">x{{item.goods_num}}</view>
      </view>
    </view>
  </view>

  <!-- 配送方式区域 -->
  <view class="delivery-type-section">
    <view class="section-title">配送方式</view>
    <view class="delivery-options">
      <view class="delivery-option" bindtap="changeDeliveryType" data-type="express">
        <text>快递配送</text>
        <radio checked="{{!isPickup}}" color="#ff4400"></radio>
      </view>
      <view class="delivery-option" bindtap="changeDeliveryType" data-type="self">
        <text>到店自提</text>
        <radio checked="{{isPickup}}" color="#ff4400"></radio>
      </view>
    </view>
  </view>

  <!-- 收货地址区域（仅快递配送时显示） -->
  <view class="address-section" wx:if="{{!isPickup}}">
    <view class="section-title">收货地址</view>
    <view class="address-content" bindtap="selectAddress">
      <view wx:if="{{selectedAddress}}" class="address-info">
        <view class="address-name">{{selectedAddress.consignee}} {{selectedAddress.mobile}}</view>
        <view class="address-detail">{{selectedAddress.province}}{{selectedAddress.city}}{{selectedAddress.district}}{{selectedAddress.address}}</view>
      </view>
      <view wx:else class="address-empty">请选择收货地址</view>
    </view>
  </view>

  <!-- 快递选择区域（仅快递配送时显示） -->
  <view class="express-section" wx:if="{{!isPickup}}">
    <view class="section-title">选择快递公司</view>
    <view class="express-options">
      <view class="express-option" bindtap="selectExpress" data-code="sf" data-name="顺丰速运">
        <text>顺丰速运</text>
        <radio checked="{{selectedExpressCode == 'sf'}}" color="#ff4400"></radio>
      </view>
      <view class="express-option" bindtap="selectExpress" data-code="jd" data-name="京东快递" wx:if="{{false}}">
        <text>京东快递</text>
        <radio checked="{{selectedExpressCode == 'jd'}}" color="#ff4400"></radio>
      </view>
    </view>
    <!-- 物流费显示 -->
    <view class="express-fee">{{sfFeeText}}</view>
  </view>

  <!-- 自提信息区域（仅自提时显示） -->
  <view class="pickup-section" wx:if="{{isPickup}}">
    <view class="section-title">自提门店信息</view>
    <view class="pickup-info">
      <view class="pickup-name">{{pickupStore.name}}</view>
      <view class="pickup-address">{{pickupStore.address}}</view>
      <view class="pickup-time">营业时间：{{pickupStore.businessTime}}</view>
      <view class="pickup-phone">联系电话：{{pickupStore.phone}}</view>
    </view>
  </view>

  <!-- 优惠券区域 -->
  <view class="coupon-section" bindtap="selectCoupon">
    <view class="section-title">优惠券</view>
    <view class="coupon-content">
      <text>{{coupon ? (coupon.coupon ? coupon.coupon.name : coupon.name) : '未使用'}}</text>
      <text class="coupon-num" wx:if="{{coupons.length > 0}}">{{coupons.length}}张可用</text>
      <icon type="arrowright" size="16"></icon>
    </view>
  </view>

  <!-- 发票区域 -->
  <view class="invoice-section" bindtap="selectInvoice">
    <view class="section-title">发票信息</view>
    <view class="invoice-content">
      <text>{{invoiceText}}</text>
      <icon type="arrowright" size="16"></icon>
    </view>
  </view>

  <!-- 留言区域 -->
  <view class="message-section">
    <view class="section-title">买家留言</view>
    <textarea 
      name="user_note"
      placeholder="请输入留言内容（选填）" 
      bindinput="onMessageInput" 
      value="{{formData.user_note}}"
      maxlength="100"
      class="message-input"
    ></textarea>
    <view class="message-length">{{messageLength}}/100</view>
  </view>

  <!-- 价格汇总 -->
  <view class="price-summary">
    <view class="price-item">
      <text class="label">商品总价：</text>
      <text class="value">¥{{orderPrices.goods_price || 0.00}}</text>
    </view>
    <view class="price-item">
      <text class="label">物流费用：</text>
      <text class="value">¥{{orderPrices.expressFee || 0.00}}</text>
    </view>
    <view class="price-item" wx:if="{{orderPrices.coupon_price > 0}}">
      <text class="label">优惠券抵扣：</text>
      <text class="value discount">-¥{{orderPrices.coupon_price}}</text>
    </view>
    <view class="price-item" wx:if="{{orderPrices.integral_money > 0}}">
      <text class="label">积分抵扣：</text>
      <text class="value discount">-¥{{orderPrices.integral_money}}</text>
    </view>
    <view class="price-item" wx:if="{{orderPrices.order_prom_amount > 0}}">
      <text class="label">订单优惠：</text>
      <text class="value discount">-¥{{orderPrices.order_prom_amount}}</text>
    </view>
    <view class="price-item total">
      <text class="label">订单总价：</text>
      <text class="value">¥{{orderPrices.total_amount || 0.00}}</text>
    </view>
  </view>

  <!-- 提交按钮 -->
  <view class="submit-btn-area">
    <button 
      class="submit-btn" 
      form-type="submit"
      id="submitOrder"
      disabled="{{!canSubmit}}"
      style="background: {{canSubmit ? '#ff4400' : '#cccccc'}}; color: white;"
    >
      {{submitBtnText}}
    </button>
  </view>

  <!-- 提示弹窗 -->
  <view class="toast" wx:if="{{showToast}}">
    <text>{{toastText}}</text>
  </view>
</view>
</form>