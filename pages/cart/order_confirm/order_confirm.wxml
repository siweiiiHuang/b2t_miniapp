<!--ä¸‹å•ç¡®è®¤é¡µé¢-->
<view class="container">

  <!-- æ”¶è´§åœ°å€ -->
  <view class="address-box" bindtap="selectAddress">
    <view wx:if="{{order.userAddress}}" class="address-content">
      <view class="user-info">
        <view class="user-name">{{order.userAddress.consignee}}</view>
        <view class="user-phone">{{order.userAddress.mobile}}</view>
      </view>
      <view class="address-info">
        {{order.userAddress.province_name}}{{order.userAddress.city_name}}{{order.userAddress.district_name}}{{order.userAddress.twon_name}}{{order.userAddress.address}}
      </view>
    </view>
    <view wx:else class="no-address">
      <view class="add-address-text">è¯·é€‰æ‹©æ”¶è´§åœ°å€</view>
    </view>
    <view class="edit-icon">ï¼</view>
  </view>

  <!-- å•†å“ä¿¡æ¯ -->
  <view class="product-list">
    <view class="product-box" wx:for="{{order.cartList}}" wx:key="id">
      <image class="product-img" src="{{resourceUrl}}{{item.original_img}}" mode="aspectFill"></image>
      <view class="product-info">
        <view class="product-name">{{item.goods_name}}</view>
        <view class="product-spec" wx:if="{{item.spec_key_name}}">{{item.spec_key_name}}</view>
        <view class="product-price-row">
          <view class="product-price">Â¥{{item.member_goods_price[0]}}.{{item.member_goods_price[1]}}</view>
          <view class="product-num">x{{item.goods_num}}</view>
        </view>
      </view>
    </view>
  </view>

  <!-- å¿«é€’é€‰æ‹© -->
  <view class="express-box" wx:if="{{!isPickup}}">
    <view class="express-title">é…é€å¿«é€’é€‰æ‹©</view>
    <view class="express-list">
      <view class="express-item {{selectedExpressCode == 'sf' ? 'active' : ''}}" 
            data-code="sf" data-name="é¡ºä¸°å¿«é€’" bindtap="selectExpress">
        <view class="express-left">
          <view class="express-icon">ğŸ“¦</view>
          <view>
            <view class="express-name">é¡ºä¸°å¿«é€’</view>
            <view class="express-fee">{{sfFeeText}}</view>
          </view>
        </view>
        <view class="radio-icon {{selectedExpressCode == 'sf' ? 'active' : ''}}"></view>
      </view>
      <!-- äº¬ä¸œå¿«é€’æš‚æ—¶å±è”½ -->
      <!-- <view class="express-item {{selectedExpressCode == 'jd' ? 'active' : ''}}" 
            data-code="jd" data-name="äº¬ä¸œå¿«é€’" bindtap="selectExpress">
        <view class="express-left">
          <view class="express-icon">ğŸš›</view>
          <view>
            <view class="express-name">äº¬ä¸œå¿«é€’</view>
            <view class="express-fee">{{jdFeeText}}</view>
          </view>
        </view>
        <view class="radio-icon {{selectedExpressCode == 'jd' ? 'active' : ''}}"></view>
      </view> -->
    </view>
  </view>

  <!-- å…¶ä»–ä¿¡æ¯ -->
  <view class="other-box">
    <view class="info-item" bindtap="selectInvoice">
      <view class="info-label">å‘ç¥¨ä¿¡æ¯</view>
      <view class="info-value">
        {{invoiceText}}
        <view class="arrow-icon">ï¼</view>
      </view>
    </view>
    <view class="info-item" bindtap="selectCoupon">
      <view class="info-label">ä¼˜æƒ åˆ¸</view>
      <view class="info-value">
        <view class="coupon-tag" wx:if="{{coupons.length > 0}}">{{coupons.length}}å¼ å¯ç”¨</view>
        <view class="coupon-tag" wx:else>0å¼ å¯ç”¨</view>
        {{couponText}}
        <view class="arrow-icon">ï¼</view>
      </view>
    </view>
  </view>

  <!-- ä¹°å®¶ç•™è¨€ -->
  <view class="message-box">
    <view class="message-title">ä¹°å®¶ç•™è¨€ï¼ˆ50å­—ï¼‰</view>
    <textarea class="message-input" 
              placeholder="é€‰å¡«ï¼šå¯¹æœ¬æ¬¡äº¤æ˜“çš„è¯´æ˜..." 
              value="{{formData.user_note}}"
              bindinput="onMessageInput"
              maxlength="50"></textarea>
    <view class="word-count">{{messageLength}}/50</view>
  </view>

  <!-- é‡‘é¢ç»Ÿè®¡ -->
  <view class="amount-box">
    <view class="amount-item">
      <view class="amount-label">å•†å“é‡‘é¢</view>
      <view class="amount-value">Â¥{{orderPrices.goodsTotalPrice || '0.00'}}</view>
    </view>
    <view class="amount-item" wx:if="{{!isPickup}}">
      <view class="amount-label">ç‰©æµè´¹ç”¨</view>
      <view class="amount-value">Â¥{{orderPrices.expressFee || expressFee || '0.00'}}</view>
    </view>
    <view class="amount-item" wx:if="{{coupon}}">
      <view class="amount-label">ä¼˜æƒ åˆ¸æŠµæ‰£</view>
      <view class="amount-value">-Â¥{{coupon.money}}</view>
    </view>
    <view class="amount-total">
      <view class="total-label">åº”ä»˜é‡‘é¢</view>
      <view class="total-value">Â¥{{orderPrices.orderTotalPrice || '0.00'}}</view>
    </view>
  </view>

  <!-- åº•éƒ¨æäº¤æ  -->
  <view class="submit-bar">
    <view class="total-price">
      <text>åº”ä»˜é‡‘é¢ï¼š</text>Â¥{{orderPrices.orderTotalPrice || '0.00'}}
    </view>
    <button class="submit-btn {{canSubmit ? '' : 'disabled'}}" 
            disabled="{{!canSubmit}}" 
            bindtap="submitOrder">
      {{submitBtnText}}
    </button>
  </view>
</view>

<!-- æç¤ºå¼¹çª— -->
<view class="toast {{showToast ? 'show' : ''}}" wx:if="{{toastText}}">
  {{toastText}}
</view>